<section class="page">
  <header class="header">
    <div>
      <h1>Create SKU</h1>
      <div class="sub">Mock create; will wire to APIs later.</div>
    </div>
    <div class="actions">
      <div class="populate">
        <span>Populate:</span>
        <select class="fx-select small" [value]="selectedTemplate()" (change)="selectedTemplate.set($any($event.target).value); populate($any($event.target).value)">
          <option *ngFor="let t of templateOptions()" [value]="t">{{ t }}</option>
        </select>
      </div>
      <a class="btn ghost" routerLink="/inventory">Back</a>
      <button class="btn" [disabled]="!isValid()" (click)="onSubmit()">Save</button>
    </div>
  </header>

  <div class="card">
    <div class="section-title">Identifiers</div>
    <div class="grid">
      <label>
        <span>Name *</span>
        <input type="text" [ngModel]="form().name" (ngModelChange)="updateField('name', $event)" placeholder="LED Light 350W" />
      </label>
      <label>
        <span>Code *</span>
        <input type="text" [ngModel]="form().code" (ngModelChange)="updateField('code', $event)" placeholder="LL1250" />
      </label>
      <label>
        <span>Prev. Code</span>
        <input type="text" [ngModel]="form().prevCode" (ngModelChange)="updateField('prevCode', $event)" placeholder="LL1250A" />
      </label>
    </div>

    <div class="section-title">Classification</div>
    <div class="grid">
      <label>
        <span>Category *</span>
        <div class="inline">
          <select class="fx-select" [value]="form().category" (change)="updateField('category', $any($event.target).value)">
            <option value="" disabled>Select category</option>
            <option *ngFor="let c of categoryOptions()" [value]="c">{{ c }}</option>
          </select>
          <input class="fx-input" #newCat placeholder="Add new" />
          <button class="small ghost" type="button" (click)="onAddCategory(newCat.value)">+ Add</button>
        </div>
      </label>

      <label>
        <span>Industry *</span>
        <select class="fx-select" [value]="form().industry" (change)="updateField('industry', $any($event.target).value)">
          <option *ngFor="let ind of industryOptions" [value]="ind">{{ ind }}</option>
        </select>
      </label>

      <label>
        <span>Sub-Category *</span>
        <div class="inline">
          <select class="fx-select" [value]="form().subCategory" (change)="updateField('subCategory', $any($event.target).value)">
            <option value="" disabled>Select sub-category</option>
            <option *ngFor="let c of subCategoryOptions()" [value]="c">{{ c }}</option>
          </select>
          <input class="fx-input" #newSub placeholder="Add new" />
          <button class="small ghost" type="button" (click)="onAddSubCategory(newSub.value)">+ Add</button>
        </div>
      </label>

      <label>
        <span>Batch Type</span>
        <select class="fx-select" [value]="form().batchType" (change)="updateField('batchType', $any($event.target).value)">
          <option value="">Select</option>
          <option *ngFor="let b of batchTypes" [value]="b">{{ b }}</option>
        </select>
      </label>
    </div>

    <div class="section-title">Quantity & Storage</div>
    <div class="grid">
      <label>
        <span>Qty *</span>
        <input type="number" min="1" [ngModel]="form().qty" (ngModelChange)="updateField('qty', +$event)" />
      </label>

      <label>
        <span>Unit *</span>
        <select class="fx-select" [value]="form().unit" (change)="updateField('unit', $any($event.target).value)">
          <option *ngFor="let u of units" [value]="u">{{ u }}</option>
        </select>
      </label>

      <label>
        <span>Store *</span>
        <div class="inline">
          <select class="fx-select" [value]="form().storeId" (change)="updateField('storeId', $any($event.target).value)">
            <option value="" disabled>Select store</option>
            <option *ngFor="let s of storeOptions()" [value]="s.id">{{ s.name }}</option>
          </select>
          <input class="fx-input" #newStore placeholder="New store" />
          <button class="small ghost" type="button" (click)="onAddStore(newStore.value)">+ Add</button>
        </div>
      </label>
    </div>

    <div class="section-title">Attributes</div>
    <div class="grid">
      <label>
        <span>Importance</span>
        <input type="text" [ngModel]="form().importance" (ngModelChange)="updateField('importance', $event)" placeholder="Critical / High / Normal" />
      </label>
      <label>
        <span>Type tags</span>
        <div class="chips">
          <button
            type="button"
            class="pill"
            [class.active]="form().types.has(t)"
            *ngFor="let t of typeOptions"
            (click)="toggleType(t)"
          >
            {{ t }}
          </button>
        </div>
      </label>

      <div class="flags">
        <span>Flags</span>
        <div class="checks">
          <label class="fx-check">
            <input type="checkbox" [checked]="form().internalManufacturing" (change)="updateField('internalManufacturing', $any($event.target).checked)" />
            Internal Manufacturing
          </label>
          <label class="fx-check">
            <input type="checkbox" [checked]="form().purchase" (change)="updateField('purchase', $any($event.target).checked)" />
            Purchase
          </label>
        </div>
      </div>
    </div>

    <div class="section-title">Pricing</div>
    <div class="grid">
      <label>
        <span>Std. Cost</span>
        <input type="number" min="0" [ngModel]="form().stdCost" (ngModelChange)="updateField('stdCost', $event === '' ? null : +$event)" />
      </label>
      <label>
        <span>Purchase Cost</span>
        <input type="number" min="0" [ngModel]="form().purchaseCost" (ngModelChange)="updateField('purchaseCost', $event === '' ? null : +$event)" />
      </label>
      <label>
        <span>Std. Sale Price</span>
        <input type="number" min="0" [ngModel]="form().salePrice" (ngModelChange)="updateField('salePrice', $event === '' ? null : +$event)" />
      </label>
    </div>
    <button class="link" type="button" (click)="openPricing()">Customer Category-wise Rates</button>

    <div class="section-title">Tax</div>
    <div class="grid">
      <label>
        <span>HSN/SAC</span>
        <input type="text" [ngModel]="form().hsnSac" (ngModelChange)="updateField('hsnSac', $event)" />
      </label>
      <label>
        <span>GST %</span>
        <input type="number" min="0" [ngModel]="form().gst" (ngModelChange)="updateField('gst', $event === '' ? null : +$event)" />
      </label>
      <label>
        <span>MRP</span>
        <input type="number" min="0" [ngModel]="form().mrp" (ngModelChange)="updateField('mrp', $event === '' ? null : +$event)" />
      </label>
    </div>

    <div class="section-title">Descriptions</div>
    <div class="grid two">
      <label>
        <span>Description</span>
        <textarea rows="2" [ngModel]="form().description" (ngModelChange)="updateField('description', $event)"></textarea>
      </label>
      <label>
        <span>Internal Notes</span>
        <textarea rows="2" [ngModel]="form().internalNotes" (ngModelChange)="updateField('internalNotes', $event)"></textarea>
      </label>
    </div>

    <div class="section-title">Policy</div>
    <div class="grid">
      <label>
        <span>Min Stock</span>
        <input type="number" min="0" [ngModel]="form().minStock" (ngModelChange)="updateField('minStock', $event === '' ? null : +$event)" />
      </label>
      <label>
        <span>Lead Time (days)</span>
        <input type="number" min="0" [ngModel]="form().leadTimeDays" (ngModelChange)="updateField('leadTimeDays', $event === '' ? null : +$event)" />
      </label>
    </div>

    <div class="section-title">Min Stock by Location</div>
    <div class="grid">
      <label *ngFor="let s of storeOptions()">
        <span>{{ s.name }}</span>
        <input type="number" min="0"
               [ngModel]="form().minStockByLocation[s.id] || 0"
               (ngModelChange)="setMinForLocation(s.id, $event)" />
      </label>
    </div>

    <div class="section-title">Tags</div>
    <div class="grid">
      <label>
        <span>Add Tag</span>
        <div class="inline">
          <input class="fx-input" [ngModel]="form().newTag" (ngModelChange)="updateField('newTag', $event)" placeholder="350W" />
          <button class="small ghost" type="button" (click)="addTag()">+ Add</button>
        </div>
        <div class="tags">
          <span class="tag" *ngFor="let t of form().tags">
            {{ t }}
            <button type="button" (click)="removeTag(t)">Ã—</button>
          </span>
        </div>
      </label>
    </div>

    <div class="footer">
      <div class="error" *ngIf="!isValid()">Fill required fields to save.</div>
      <div class="spacer"></div>
      <a class="btn ghost" routerLink="/inventory">Cancel</a>
      <button class="btn" [disabled]="!isValid()" (click)="onSubmit()">Save</button>
    </div>
  </div>
</section>
